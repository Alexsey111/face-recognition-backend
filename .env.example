# env.example
# в alembic.ini# Face Recognition Service - Пример конфигурации окружения
# Скопируйте этот файл в .env и заполните реальными значениями

# =============================================================================
# БАЗОВЫЕ НАСТРОЙКИ ПРИЛОЖЕНИЯ
# =============================================================================
APP_NAME=Face Recognition Service
DEBUG=false
ENVIRONMENT=production
HOST=0.0.0.0
PORT=8000
LOG_LEVEL=INFO

# =============================================================================
# CORS НАСТРОЙКИ
# =============================================================================
# Разрешенные источники для CORS (через запятую)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080,https://yourdomain.com

# =============================================================================
# БАЗА ДАННЫХ
# =============================================================================
# Для разработки (SQLite)
# DATABASE_URL=sqlite:///./dev.db

# Для production (PostgreSQL)
DATABASE_URL=postgresql://face_user:your_secure_password@localhost:5432/face_recognition_db

# Настройки пула соединений
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20
DATABASE_POOL_TIMEOUT=30

# =============================================================================
# REDIS (КЭШИРОВАНИЕ)
# =============================================================================
# Для разработки
# REDIS_URL=redis://localhost:6379/0

# Для production с аутентификацией
REDIS_URL=redis://username:password@localhost:6379/0
REDIS_PASSWORD=your_redis_password
REDIS_SOCKET_TIMEOUT=5
REDIS_CONNECTION_POOL_SIZE=10

# =============================================================================
# S3/MINIO (ОБЪЕКТНОЕ ХРАНИЛИЩЕ)
# =============================================================================
# Для локальной разработки с MinIO
S3_ENDPOINT_URL=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin123
S3_BUCKET_NAME=face-recognition
S3_REGION=us-east-1
S3_USE_SSL=false

# Для AWS S3 в production
# S3_ENDPOINT_URL=https://s3.amazonaws.com
# S3_ACCESS_KEY=your_aws_access_key
# S3_SECRET_KEY=your_aws_secret_key
# S3_BUCKET_NAME=your-production-bucket
# S3_REGION=us-east-1
# S3_USE_SSL=true

# =============================================================================
# MINIO/S3 НАСТРОЙКИ (PHASE 5)
# =============================================================================
# MinIO endpoint (совместим с S3_ENDPOINT_URL)
MINIO_ENDPOINT=http://localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin123
MINIO_REGION=us-east-1
MINIO_BUCKET=face-recognition
MINIO_SSL=false

# Настройки файлов (Phase 5)
MAX_FILE_SIZE_MB=10
UPLOAD_EXPIRATION_DAYS=30
CLEANUP_INTERVAL_HOURS=24

# =============================================================================
# ML СЕРВИС
# =============================================================================
# URL ML сервиса для распознавания лиц
ML_SERVICE_URL=http://localhost:8001
ML_SERVICE_TIMEOUT=30
ML_SERVICE_API_KEY=your_ml_service_api_key

# =============================================================================
# JWT ТОКЕНЫ
# =============================================================================
# Секретный ключ для JWT (должен быть уникальным и сложным)
JWT_SECRET_KEY=your-super-secret-jwt-key-make-it-very-long-and-complex-2024
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# =============================================================================
# ШИФРОВАНИЕ
# =============================================================================
# Ключ для шифрования эмбеддингов и чувствительных данных (Fernet)
# Fernet автоматически генерирует соли и обеспечивает уникальность шифротекстов
ENCRYPTION_KEY=your-256-bit-encryption-key-for-embeddings-and-sensitive-data
ENCRYPTION_ALGORITHM=fernet

# =============================================================================
# RATE LIMITING
# =============================================================================
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10

# =============================================================================
# БЕЗОПАСНОСТЬ
# =============================================================================
# Максимальный размер загружаемого файла (в байтах)
MAX_UPLOAD_SIZE=10485760

# Разрешенные форматы изображений (через запятую)
ALLOWED_IMAGE_FORMATS=JPEG,JPG,PNG,WEBP

# Минимальные размеры изображения
MIN_IMAGE_WIDTH=224
MIN_IMAGE_HEIGHT=224

# Максимальные размеры изображения
MAX_IMAGE_WIDTH=4096
MAX_IMAGE_HEIGHT=4096

# =============================================================================
# WEBHOOK НАСТРОЙКИ
# =============================================================================
WEBHOOK_TIMEOUT=10
WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAY=5

# =============================================================================
# УВЕДОМЛЕНИЯ
# =============================================================================
# Slack уведомления
ENABLE_SLACK_NOTIFICATIONS=false
SLACK_WEBHOOK_URL=

# Email уведомления
ENABLE_EMAIL_NOTIFICATIONS=false
EMAIL_SMTP_HOST=
EMAIL_SMTP_PORT=587
EMAIL_USERNAME=
EMAIL_PASSWORD=

# =============================================================================
# МОНИТОРИНГ И МЕТРИКИ
# =============================================================================
ENABLE_METRICS=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=30

# =============================================================================
# ЛОГИРОВАНИЕ
# =============================================================================
# Формат логов: json или text
LOG_FORMAT=json

# Путь к файлу логов (опционально)
LOG_FILE_PATH=

# Ротация логов
LOG_MAX_SIZE=104857600  # 100MB
LOG_BACKUP_COUNT=5

# =============================================================================
# ДОПОЛНИТЕЛЬНЫЕ НАСТРОЙКИ ДЛЯ PRODUCTION
# =============================================================================

# Пароли для внешних сервисов
DB_PASSWORD=your_secure_database_password
REDIS_PASSWORD=your_redis_password
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin123
GRAFANA_PASSWORD=admin_password

# SSL сертификаты (если используется HTTPS)
SSL_CERT_PATH=
SSL_KEY_PATH=

# Внешние API ключи
OPENAI_API_KEY=
GOOGLE_VISION_API_KEY=
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# Настройки отправки email
SMTP_SERVER=
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
FROM_EMAIL=noreply@yourdomain.com

# Настройки мониторинга
SENTRY_DSN=
PROMETHEUS_ENDPOINT=

# =============================================================================
# НАСТРОЙКИ ДЛЯ DEVELOPMENT ОКРУЖЕНИЯ
# =============================================================================
# Эти настройки используются только в development окружении

# Development база данных
DEV_DB_PASSWORD=dev_password

# Development MinIO
DEV_MINIO_ROOT_USER=minioadmin
DEV_MINIO_ROOT_PASSWORD=minioadmin123

# Development pgAdmin
DEV_PGADMIN_EMAIL=admin@face-recognition.local
DEV_PGADMIN_PASSWORD=admin

# =============================================================================
# НАСТРОЙКИ ДЛЯ РАЗРАБОТКИ
# =============================================================================
# Эти настройки используются только в development окружении

# Автоматическая перезагрузка при изменении кода
AUTO_RELOAD=true

# Подробное логирование SQL запросов
SQL_ECHO=false

# Включение debug toolbar
DEBUG_TOOLBAR=false

# Настройки тестирования
TEST_DATABASE_URL=sqlite:///./test.db
TEST_REDIS_URL=redis://localhost:6380/1

# =============================================================================
# ВАЖНЫЕ ЗАМЕТКИ
# =============================================================================
# 1. НИКОГДА не коммитьте файл .env в систему контроля версий
# 2. Используйте сложные пароли и ключи в production
# 3. Регулярно обновляйте секретные ключи
# 4. Для production используйте переменные окружения системы или Docker secrets
# 5. Убедитесь, что все внешние сервисы (БД, Redis, MinIO) доступны
# 6. Проверьте настройки безопасности (CORS, rate limiting, etc.)

# =============================================================================
# ГЕНЕРАЦИЯ КЛЮЧЕЙ (добавь эти примеры)
# =============================================================================
# Генерация JWT_SECRET_KEY:
# python3 -c "import secrets; print(secrets.token_urlsafe(32))"
# Генерация ENCRYPTION_KEY для Fernet:
# python3 -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# Генерация случайного пароля:
# python3 -c "import secrets; print(secrets.token_urlsafe(24))"
# Проверка текущих ключей:
# python3 -c "from app.config import settings; print('JWT:', len(settings.JWT_SECRET_KEY)); print('ENC:', len(settings.ENCRYPTION_KEY))"

# =============================================================================
# ГЕНЕРАЦИЯ СЕКРЕТНЫХ КЛЮЧЕЙ (bash команды)
# =============================================================================
# JWT_SECRET_KEY: openssl rand -hex 32
# ENCRYPTION_KEY: openssl rand -base64 32  # Для Fernet (32 байта в base64)
# DB_PASSWORD: openssl rand -base64 24

# =============================================================================
# ОБЯЗАТЕЛЬНЫЕ ПОЛЯ ДЛЯ PRODUCTION
# =============================================================================
# REQUIRED: DATABASE_URL
# REQUIRED: JWT_SECRET_KEY
# REQUIRED: ENCRYPTION_KEY (для Fernet шифрования эмбеддингов)
# REQUIRED: S3_ACCESS_KEY
# REQUIRED: S3_SECRET_KEY

# ============================================================================
# Anti-Spoofing Configuration (MiniFASNetV2) - Phase 7
# ============================================================================

# Enable/Disable certified liveness detection with MiniFASNetV2
# Default: false (для обратной совместимости)
USE_CERTIFIED_LIVENESS=false

# Path to MiniFASNetV2 model file (.pth)
# Model will be downloaded automatically if not found (when ANTISPOOFING_AUTO_DOWNLOAD_MODEL=true)
CERTIFIED_LIVENESS_MODEL_PATH=models/minifasnet_v2.pth

# Classification threshold for real/spoof detection
# 0.5 = balanced (recommended), >0.5 = stricter (lower FAR, higher FRR)
# Recommended range: 0.4-0.6
CERTIFIED_LIVENESS_THRESHOLD=0.5

# Expected model version for validation
EXPECTED_MODEL_VERSION=v2.0.1

# Input dimensions for MiniFASNetV2 (standard: 80x80)
ANTISPOOFING_INPUT_WIDTH=80
ANTISPOOFING_INPUT_HEIGHT=80

# Normalization parameters for MiniFASNetV2
# Standard: mean=[0.5, 0.5, 0.5], std=[0.5, 0.5, 0.5] (normalizes to [-1, 1])
# Alternative (ImageNet): mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225]
# ANTISPOOFING_NORMALIZE_MEAN=0.5,0.5,0.5
# ANTISPOOFING_NORMALIZE_STD=0.5,0.5,0.5

# Enable auxiliary spoofing checks (moiré patterns, texture analysis, etc.)
ANTISPOOFING_ENABLE_AUXILIARY_CHECKS=true

# Target inference times for performance monitoring (seconds)
ANTISPOOFING_TARGET_INFERENCE_TIME_CPU=0.1   # 100ms on CPU
ANTISPOOFING_TARGET_INFERENCE_TIME_GPU=0.02  # 20ms on GPU

# Auto-down====================================================================
# How to enable Anti-Spoofing:
# ============================================================================
# 1. Set USE_CERTIFIED_LIVENESS=true
# 2. Restart the application
# 3. Model will be downloaded automatically to models/minifasnet_v2.pth
# 4. Check logs for initialization status
#
# Performance expectations:
# - CPU: ~100ms per inference
# - GPU: ~20ms per inference
# - Accuracy: >98% (certified)
#
# Troubleshooting:
# - If model fails to download, set ANTISPOOFING_AUTO_DOWNLOAD_MODEL=false
# - Manually download from: https://github.com/minivision-ai/Silent-Face-Anti-Spoofing
# - Place in: models/minifasnet_v2.pth
# ======================================load model if not found
ANTISPOOFING_AUTO_DOWNLOAD_MODEL=true

# Model download URL (GitHub release)
# ANTISPOOFING_MODEL_DOWNLOAD_URL=https://github.com/minivision-ai/Silent-Face-Anti-Spoofing/raw/master/resources/anti_spoof_models/2.7_80x80_MiniFASNetV2.pth

# ==============================================
