# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Docker Compose

## üìã –û–±–∑–æ—Ä —Ñ–∞–π–ª–æ–≤

–ü—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Docker Compose —Ñ–∞–π–ª–æ–≤:

- **`docker-compose.yml`** - –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **`docker-compose.dev.yml`** - –†–∞–∑—Ä–∞–±–æ—Ç—á–µ—Å–∫–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- **`docker-compose.monitoring.yml`** - –°–µ—Ä–≤–∏—Å—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **`docker-compose.test.yml`** - –¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)

## üîß –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

### Production –∑–∞–ø—É—Å–∫
```bash
# –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (API + –ë–î + Redis + MinIO)
docker-compose up -d

# –° –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º (–≤–∫–ª—é—á–∞–µ—Ç Nginx + Prometheus + Grafana)
docker-compose -f docker-compose.yml -f docker-compose.monitoring.yml up -d
```

### Development –∑–∞–ø—É—Å–∫
```bash
# –†–∞–∑—Ä–∞–±–æ—Ç—á–µ—Å–∫–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å hot-reload
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
```

### –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ (production + –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–∫–ª—é—á–∞—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
docker-compose -f docker-compose.yml -f docker-compose.monitoring.yml up -d
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - Docker Secrets

–í—Å–µ –ø–∞—Ä–æ–ª–∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç Docker Secrets –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

### –§–∞–π–ª—ã —Å–µ–∫—Ä–µ—Ç–æ–≤
–°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `secrets/` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏:

```bash
secrets/
‚îú‚îÄ‚îÄ db_password.txt          # –ü–∞—Ä–æ–ª—å PostgreSQL
‚îú‚îÄ‚îÄ redis_password.txt       # –ü–∞—Ä–æ–ª—å Redis
‚îú‚îÄ‚îÄ minio_root_password.txt  # –ü–∞—Ä–æ–ª—å MinIO
‚îî‚îÄ‚îÄ grafana_password.txt     # –ü–∞—Ä–æ–ª—å Grafana
```

### –ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤:
```bash
# secrets/db_password.txt
my_secure_db_password_123

# secrets/redis_password.txt  
my_secure_redis_password_456

# secrets/minio_root_password.txt
my_secure_minio_password_789

# secrets/grafana_password.txt
my_secure_grafana_password_000
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `secrets/` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `.gitignore` –∏ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–æ–ø–∞–¥–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π!

## üîÑ Restart Policy

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º:

```yaml
deploy:
  restart_policy:
    condition: on-failure  # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
    delay: 5s              # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
    max_attempts: 3        # –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫
```

## üåê –°–µ—Ä–≤–∏—Å—ã –∏ –ø–æ—Ä—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (docker-compose.yml)
- **face-recognition-api**: `8000` - –û—Å–Ω–æ–≤–Ω–æ–µ API
- **postgres**: `5432` - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **redis**: `6379` - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **minio**: `9000, 9001` - –û–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (docker-compose.monitoring.yml)
- **nginx**: `80, 443` - Reverse proxy
- **prometheus**: `9090` - –ú–µ—Ç—Ä–∏–∫–∏
- **grafana**: `3000` - –î–∞—à–±–æ—Ä–¥—ã

### Development (docker-compose.dev.yml)
- **face-recognition-api-dev**: `8000, 5678` - API + Debug port
- **postgres-dev**: `5433` - Dev –ë–î
- **redis-dev**: `6380` - Dev Redis
- **minio-dev**: `9001, 9002` - Dev MinIO
- **pgadmin**: `5050` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î
- **redis-commander**: `8081` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Redis

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã:

- **Grafana**: http://localhost:3000 (–ª–æ–≥–∏–Ω: admin)
- **Prometheus**: http://localhost:9090
- **Nginx**: http://localhost (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose logs -f

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
docker-compose logs -f face-recognition-api

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100 face-recognition-api
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö
docker-compose restart

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose restart face-recognition-api
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º —Ç–æ–º–æ–≤
docker-compose down -v
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
```bash
# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ healthcheck
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health —Å—Ç–∞—Ç—É—Å–∞
docker-compose exec face-recognition-api curl -f http://localhost:8000/health
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
docker-compose exec postgres psql -U face_user -d face_recognition_db

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
docker-compose exec redis redis-cli ping
```

## üö® Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å secrets
–ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫–∏ –æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å–µ–∫—Ä–µ—Ç–∞—Ö:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –≤ `secrets/` —Å–æ–∑–¥–∞–Ω—ã
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Ç–∞–µ–º—ã–º–∏)

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—Ç–∞–º–∏
–ï—Å–ª–∏ –ø–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã:
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–Ω—è—Ç—ã–µ –ø–æ—Ä—Ç—ã
netstat -tulpn | grep :8000

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
docker-compose down
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å volumes
```bash
# –û—á–∏—Å—Ç–∫–∞ —Ç–æ–º–æ–≤ (–≤–Ω–∏–º–∞–Ω–∏–µ: —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!)
docker-compose down -v

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–º–æ–≤
docker volume prune
```

## üìà Production —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ secrets** –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–∞—Ä–æ–ª–µ–π
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ —Ñ–∞–π–ª—ã —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ volumes** –¥–ª—è persistent –¥–∞–Ω–Ω—ã—Ö
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ backup** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –≤ production
6. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è Nginx

---

**üéØ –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞!**